# This file is automatically generated by the setup container.
# For overrides, use docker-compose.override.yml file.

# Only some portions of the file have been preserved as an example.

# Paths on host
# - ./config
#   - ./config/minecraft
#   - ./config/mods
#   - ./config/borgmatic
#   - ./config/mcaselector
#   - ./config/nginx
# - ./data
#   - ./data/server
#   - ./data/world
#   - ./data/map
# - ./backups

services:
  # ========== Backups ==========

  # Application to handle backups using BorgBackup
  borgmatic-minecraft:
    image: ghcr.io/borgmatic-collective/borgmatic:latest
    container_name: borgmatic-minecraft
    env_file:
      - .env
    volumes:
      - scripts:/scripts:ro
      - ./backups:/mnt/borg-repository
      - ./data/server:/mnt/source/server:ro
      - ./data/world:/mnt/source/world:ro
      - ./config:/mnt/source/config:ro
      - ./config/borgmatic:/etc/borgmatic.d
    secrets:
      - borg_passphrase
    entrypoint: ["/scripts/borgmatic/entrypoint.sh"]
    restart: no

# ==========

volumes:
  scripts:
    driver: local

secrets:
  borg_passphrase:
    file: ./.secrets/borg_passphrase
  cloudflared_token:
    file: ./.secrets/cloudflared_token
  cf_api_key:
    file: ./.secrets/cf_api_key
